% Systèmes d'exploitation pour ingénieurs
% Antoine Gagné
% 19 février 2016

# Introduction

Ce chapitre est une introduction et fera une brève introduction des systèmes d'exploitation.

## Architecture d'un ordinateur

Un ordinateur est composé de plusieurs couches:

- Couche logiciel
- Couche noyau
- Couche matériel

### Couche logiciel

La couche logiciel est la couche dans laquelle vit l'utilisateur. Elle ne peut exécuter que quelques
instructions machines. En particulier, les opérations qui modifient le contrôle de la machine ou qui
font de l'**entrée/sortie** (**I/O**) sont interdites dans cette couche.

### Couche noyau

La couche noyau est la couche dans laquelle vit le système d'exploitation. Elle a un contrôle absolu
sur le matériel et peut exécuter n'importe quelles instructions que la machine permet.

### Couche matériel

La couche matériel est la couche dans laquelle on retrouve le matériel qui compose l'ordinateur ainsi
que les instructions machines que les composants permettent.

## Système d'exploitation

Dans cette section, nous verrons brièvement les systèmes d'exploitation.

### Définition d'un système d'exploitation

Un système d'exploitation  est l'ensemble des programmes qui communiquent avec le matériel et
contrôlent l'**allocation des ressources** aux autres programmes du système.

### Buts principaux

Les buts d'un système d'exploitation sont

- Offrir une abstraction de haut-niveau des ressources
- Gérer les ressources matérielles de l'ordinateur

### Composantes

#### Noyau

- Niveau privilège noyau
- Accès à toutes les ressources

#### Librairie système

- Niveau privilège utilisateur
- Interface pour les appels systèmes

#### Programmes systèmes

## Processeurs

### Principaux registres

Il y a plusieurs registres dans un processeur

- Compteur ordinal / *Program Counter* (PC)
- Pointeur de pile / *Stack pointer*
- Mot d'état / *Program status word*

Ces registres sont préservés lors d'un changement de contexte.

#### Compteur ordinal / *Program Counter* (PC)

Ce registre donne l'adresse de l'instruction en cours.

#### Pointeur de pile / *Stack pointer*

Ce registre donne l'adresse courante du sommet de la pile. 

##### Pile

La pile contient l'adresse de retour des fonctions. Elle contient aussi les paramètres lors
de l'appel de fonction. Elle contient aussi les variables locales de la fonction.

#### Mot d'état / *Program status word*

Ce registre donne l'état du processeur et les bits de comparaison (zéro, overflow, etc.). Il
est très important pour les opérations IO.

## Mémoire

Temps d'accès               Couche              Capacité
---------------             --------------      -----------
1 nsec                      Registres           < 1 KB
2 nsec                      Cache                 4 MB
10 nsec                     Mémoire pricipale     1-8 GB
10 msec                     Bande magnétique      1-4 TB
---------------             --------------      -----------

## Appel système

### Définition

- Fonctionnalité fournie par le noyau du système d'exploitation
- Fait par l'entremise de la librairie système
- Doit ultimement tourner en mode noyau
- L'appelant tourne en mode utilisateur

#### Exemples

- `read`/`write`: lecture/écriture fichier
- `brk`: gestion de la mémoire
- `fork`: créer un nouveau processus
- `waitpid`: attendre la fin d'un processus
- `kill`: signaler un processus
- `time`: avoir l'heure

Il y en a environ 300 sur Linux.

### Privilèges

- Nécessite un changement de niveau de privilège
- Se fait lors de l'exécution d'instructions machines particulières:
    - interruption logiciel `INT n` ou
    - `SYSCALL`/`SYSENTER`


### Table des interruptions IDT

- Remplie lors du démarrage par la fonction `trap_init()`
- Toutes des fonctions du noyau
- `int 0x80` est une instruction assembleur qui spécifie au système de passer le contrôle au noyau

### Exemple d'exécution d'un appel système

```C
cpt = read(df, &tampon, nbOctets);
```
